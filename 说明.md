# ROS2 入门与实现

## 第一章  RO2 地安装

安装教程  自己搜索

## 第二章  通信机制

### 2.1. 话题通信

创建服务

```sh
#初始化环境变量
. install/local_setup.bash
#创建服务命令
ros2 pkg create cpp04_param --build-type ament_cmake  --dependencies rclcpp base_interfase --node-name topic

```

### 2.2. 服务通信

1. 创建公共依赖包

```sh
ros2 pkg create base_interface --build-type ament_cmake
```

2. 编译公共依赖包

```xml

  <build_depend>rosidl_default_generators</build_depend>
  <exec_depend>rosidl_default_runtime</exec_depend>
  <member_of_group>rosidl_interface_packages</member_of_group>

```

3. 编译依赖包

```sh
#初始化环境变量
. install/local_setup.bash

colcon build --packages-select base-interface
```

4. 创建项目

```sh

#注意 dependencies 中的依赖 有  rclcpp  std_msgs  base_interfase
ros2 pkg create cpp04_param --build-type ament_cmake  --dependencies rclcpp  std_msgs  base_interfase --node-name topic
```

### 2.3. 动作通信

* 编辑 依赖 添加 动作属性 Action

```sh
int32 req
---
int32 resp
---
float64 progrees

```

* 编辑 xml

```xml

  <buildtool_depend>rosidl_default_generators</buildtool_depend>
  <depend>action_msgs</depend>
```

* 输出添加的 参数

```shell


. install/local_setup.bash 
ros2 interface show base_interfase/action/Progrees
```

* 调试命令

```shell

ros2 action send_goal /get_sum base_interfase/action/Progrees  "req: -10" -f

```

### 2.4. 参数通信

创建项目

```sh

ros2 pkg create cpp04_param --build-type ament_cmake  --dependencies rclcpp base_interfase --node-name param
```

终端查询

```sh
ros2 param  get /Param_Server length
```

## 第三章 工作空间管理 与 命令行工具

### 3.1. 元功能包 （多个模块通过 launch 整合 ）

1. 创建元功能包

   命令行

```bash

ros2 pkg  create cpp05_launch

```

### 3.2. 工作空间

#### 1. 节点重名

1. 命令行的方式解决 节点重名

```bash
# 启动节点 使用命名空间 防止重名
ros2  run  turtlesim turtlesim_node --ros-args --remap __ns:=/t1

# 启动节点 使用匿名 防止重名
## 方法1
ros2  run  turtlesim turtlesim_node --ros-args --remap __name:=/t1
## 方法2
ros2  run  turtlesim turtlesim_node --ros-args --remap __node:=/t2

# 命名空间 和 
ros2  run  turtlesim turtlesim_node --ros-args  --remap __ns:=/t1  --remap  __node:=/t2  


## 查看 节点 列表
ros2 node list
```

#### 2 话题重名

### 3.3. 时间API

1. API_Rate 时间间隔  方式 hz  , ms
2. API_Time 当前时间 ， 时间比较
3. API_Duration 持续时间

### 3.4. 命令行工具

#### 启动乌龟

```bash

# 服务端
ros2  run  turtlesim turtlesim_node

# 建瓯控制窗口
ros2 run turtlesim turtle_teleop_key 

```

1. node 基本语法

```bash

# info 输出节点信息
ros2 node info 
# list 输出节点列表
ros node list 

```

2. interace 接口

   ```bash

   # 输出所有可用的接口信息
   ros2 interface list

   # 输出制定功能包下的
   ros2 interface package turtlesim_msgs

   # 输出包含接口消息的功能包
   ros2 interface packages

   # 输出消息原型
   ros2 interface proto std_msgs/msg/String

   ```
3. potic 话题

   ```bash
   ros2 topic  hz  /turtle1/pose
   # 输出话题列表
   ros2 topic list

   # 显示占有的带宽
   ros2 topic bw /turtle1/pose

   # 查询话题类型
   ros2 topic  type  /turtle1/pose

   # 查询消息类型
   ros2 topic  find  turtlesim_msgs/msg/Pose 

   # 显示实时位置姿态
   ros2 topic  echo  /turtle1/pose

   # 获取消息发布的 频率
   ros2 topic  hz  /turtle1/pose

   # 查询话题的相关信息
   ros2 topic  info  /turtle1/pose

   # pub 话题上发布消息 
   ros2 topic pub /turtle1/cmd_vel geometry_msgs/msg/Twist "{linear:{x: 5},angular:{z: 1.0}}" -r 10

   ```
4. service 服务

   ```bash

   # 列出当前正在运行中的服务
   ros2 service list

   #创建一只乌龟
   ros2 service call /spawn turtlesim_msgs/srv/Spawn "{x: 1.0, y: 1.0,theta: 1.57, name: toto}"

   # 查询服务的接口类型
   ros2 service  type /spawn

   # 查询服务话题
   ros2 service find turtlesim_msgs/srv/Spawn

   # 清理运行规矩
   ros2 service call /clear std_srvs/srv/Empty {}\

   # 杀死乌龟
   ros2 service call /kill turtlesim_msgs/srv/Kill "{name: toto}"
   ```
5. 动作通信

   ```bash

   # 动作列表 （获取到一个控制乌龟航向的地址）
   ros2 action list

   # 查询详情 （获取到 客户端和服务端的名称） 
   ros2 action info /turtle1/rotate_absolute

   # 发送动作 （乌龟掉头）
   ros2 action send_goal /turtle1/rotate_absolute  turtlesim_msgs/action/RotateAbsolute "theta: 0.0" -f
   ```
6. param 参数

```bash

# 参数列表
ros2 param list

# 获取参数
ros2 param get /turtlesim background_r

# 修改参数
ros2 param set /turtlesim background_r 0

# 获取参数的描述信息
ros2 param describe /turtlesim background_g

# 导出参数
ros2 param dump /turtlesim  >> param.yaml

# 加载 
ros2 param load /turtlesim  param.yaml

```

### 3.5. 通信机制实践

1. 创建项目

```bash


ros2 pkg create cpp07_exercise \
--build-type ament_cmake \
--dependencies rclcpp base_interfase turtlesim geometry_msgs rclcpp_action \
--node-name exer01_pub_sub


```
